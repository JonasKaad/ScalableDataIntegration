
@inject ISnackbar Snackbar
@inject IDialogService DialogService

<MudStack>
    <MudGrid>
        <MudItem xs="12">
                    <MudAutocomplete @bind-Value=ParserName
                                     Clearable="true"
                                     SearchFunc="Search"
                                     Variant="Variant.Outlined"
                                     Label="Select Parser"
                                     Placeholder="No Parser Selected"
                                     />
        </MudItem>
        
        <MudItem xs="12">
            <MudButton OnClick="@(() => OpenFileDialogAsync())" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.FileUpload" Color="Color.Primary">
                Upload Dataset
            </MudButton>
           
        </MudItem>
        <MudItem>
            <MudButton OnClick="@(() => OpenReparseDialogAsync())" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.PublishedWithChanges" Color="Color.Primary">
                Fetch and Parse Latest Dataset
            </MudButton>
        </MudItem>
    </MudGrid>
</MudStack>

@code {

    private string[] _parsers =
    [
        "NatTrackParser","BufrParser","WeatherParser", "MetarParser", "SigmetParser", "AirepParser", "NotamParser", "TafParser", "GfsParser", 
        "PacotParser", "TrackParser", "FlightPlanParser", "RadarParser", "SatelliteParser", "OceanicRouteParser", 
        "WindParser", "TemperatureParser", "TurbulenceParser", "IcingParser", "CloudParser", "StormParser", 
        "AviationWeatherParser", "AirspaceParser", "TrafficParser", "RunwayParser", "AirportParser", "FuelDataParser", 
        "ClearanceParser", "LoadSheetParser", "PirepParser", "FIRParser", "SectorParser"
    ];
    
    private async Task<IEnumerable<string>> Search(string value, CancellationToken token)
    {
        // if text is null or empty, show complete list
        if (string.IsNullOrEmpty(value))
            return _parsers;

        return _parsers.Where(x => x.Contains(value, StringComparison.InvariantCultureIgnoreCase));
    }

}
